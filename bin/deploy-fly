#!/bin/bash
set -e

echo "ğŸš€ Starting Fly.io deployment..."

echo "0ï¸âƒ£ Destroying existing app (if any)..."
fly apps destroy lumbre --yes || echo "App didn't exist, continuing..."

echo "1ï¸âƒ£ Creating Fly.io app..."
fly apps create lumbre

echo "2ï¸âƒ£ Creating persistent volume..."
fly volumes create lumbre_data --region iad --size 10 --yes

echo "3ï¸âƒ£ Setting Rails master key..."
fly secrets set RAILS_MASTER_KEY=$(cat config/master.key)

echo "4ï¸âƒ£ Deploying application..."
fly deploy

echo "âœ… Deployment complete!"
echo "ğŸŒ Your app is available at: https://lumbre.fly.dev"